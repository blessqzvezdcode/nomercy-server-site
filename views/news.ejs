<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ù–æ–≤–æ—Å—Ç–∏ - NoMercy Marketplace</title>
  <link rel="stylesheet" href="/css/base.css">
<link rel="stylesheet" href="/css/news.css">
</head>
<body>
    <nav>
        <a href="/" class="brand">NoMercy</a>
        <div class="nav-buttons">
            <% if (user) { %>
                <a href="/messenger" class="nav-messenger-btn" title="–ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä">üí¨</a>
                <div class="dropdown">
                    <button class="dropdown-toggle">
                        <span>üë§ <%= user.name %> (üí∞ <%= balance %>)</span>
                    </button>
                    <div class="dropdown-menu">
                        <a href="/" class="dropdown-item">üè† –ì–ª–∞–≤–Ω–∞—è</a>
                        <a href="/profile/<%= user.id %>" class="dropdown-item">üë§ –ü—Ä–æ—Ñ–∏–ª—å</a>
                        <a href="/market" class="dropdown-item">üõí –ú–∞—Ä–∫–µ—Ç</a>
                        <a href="/cards" class="dropdown-item">üÉè –ö–∞—Ä—Ç—ã</a>
                        <a href="/quests" class="dropdown-item">‚öîÔ∏è –ö–≤–µ—Å—Ç—ã</a>
                        <a href="/games" class="dropdown-item">üéÆ –ò–≥—Ä—ã</a>
                        <a href="/news" class="dropdown-item active">üì∞ –ù–æ–≤–æ—Å—Ç–∏</a>
                        <a href="/faq" class="dropdown-item">‚ùì FAQ</a>
                        <a href="/achievements" class="dropdown-item">üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</a>
                        <a href="/support" class="dropdown-item">üéß –ü–æ–¥–¥–µ—Ä–∂–∫–∞</a>
                        <div class="dropdown-divider"></div>
                        <% if (user.role === 'admin') { %>
                            <a href="/admin" class="dropdown-item">‚öôÔ∏è –ê–¥–º–∏–Ω–∫–∞</a>
                            <div class="dropdown-divider"></div>
                        <% } %>
                        <button class="dropdown-item theme-toggle" id="theme-toggle">üåô –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞</button>
                        <div class="dropdown-divider"></div>
                        <a href="/logout" class="dropdown-item">üö™ –í—ã–π—Ç–∏</a>
                    </div>
                </div>
            <% } else { %>
                <a href="/auth/discord" class="btn">–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Discord</a>
            <% } %>
        </div>
    </nav>

<div class="container">
  <div class="news-header">
    <div class="news-title-section">
      <h1>üì∞ –ù–æ–≤–æ—Å—Ç–∏ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è</h1>
      <p class="news-subtitle">–°–ª–µ–¥–∏—Ç–µ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–º–∏ —Å–æ–±—ã—Ç–∏—è–º–∏ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã</p>
    </div>
    <% if (user && user.role === 'admin') { %>
      <div class="news-admin-actions">
        <button onclick="showCreateNewsModal()" class="btn btn-primary">
          <span>‚úèÔ∏è</span>
          –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ—Å—Ç—å
        </button>
      </div>
    <% } %>
  </div>

  <!-- Categories Filter -->
  <div class="card filters-card">
    <div class="filters-row">
      <div class="filter-group">
        <label>üìã –ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
        <select id="categoryFilter" class="form-select">
          <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
          <option value="updates">–û–±–Ω–æ–≤–ª–µ–Ω–∏—è</option>
          <option value="events">–°–æ–±—ã—Ç–∏—è</option>
          <option value="announcements">–û–±—ä—è–≤–ª–µ–Ω–∏—è</option>
          <option value="security">–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</option>
          <option value="market">–ú–∞—Ä–∫–µ—Ç</option>
        </select>
      </div>
      <div class="filter-group">
        <label>üìÖ –ü–µ—Ä–∏–æ–¥</label>
        <select id="periodFilter" class="form-select">
          <option value="">–í—Å–µ –≤—Ä–µ–º—è</option>
          <option value="today">–°–µ–≥–æ–¥–Ω—è</option>
          <option value="week">–ù–µ–¥–µ–ª—è</option>
          <option value="month">–ú–µ—Å—è—Ü</option>
        </select>
      </div>
      <button class="btn" onclick="applyFilters()">
        <span class="btn-icon">üîç</span>
        –ü—Ä–∏–º–µ–Ω–∏—Ç—å
      </button>
    </div>
  </div>

  <!-- News Grid -->
  <div class="news-grid">
    <% if (news && news.length) { %>
      <% news.forEach(function(article){ %>
        <div class="news-card" data-category="<%= article.category %>" data-date="<%= article.date %>">
          <div class="news-card-header">
            <div class="news-category category-<%= article.category %>">
              <%= article.category === 'updates' ? 'üîÑ' : 
                  article.category === 'events' ? 'üéâ' : 
                  article.category === 'announcements' ? 'üì¢' : 
                  article.category === 'security' ? 'üîí' : 
                  article.category === 'market' ? 'üí∞' : 'üì∞' %>
              <%= article.categoryName || article.category %>
            </div>
            <div class="news-date">
              <%= new Date(article.date).toLocaleDateString('ru-RU') %>
            </div>
          </div>
          
          <div class="news-content">
            <h3 class="news-title"><%= article.title %></h3>
            <p class="news-excerpt"><%= article.excerpt %></p>
            
            <% if (article.image) { %>
              <div class="news-image">
                <img src="<%= article.image %>" alt="<%= article.title %>">
              </div>
            <% } %>
            
            <div class="news-meta">
              <div class="news-author">
                <span class="author-icon">üë§</span>
                <%= article.author %>
              </div>
            </div>
          </div>
          
          <div class="news-actions">
            <a href="/news/<%= article.id %>" class="btn ghost">
              <span class="btn-icon">üìñ</span>
              –ß–∏—Ç–∞—Ç—å –¥–∞–ª–µ–µ
            </a>
            <% if (user && user.role === 'admin') { %>
              <a href="/admin/news/edit/<%= article.id %>" class="btn ghost">
                <span class="btn-icon">‚úèÔ∏è</span>
                –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
              </a>
            <% } %>
          </div>
        </div>
      <% }) %>
    <% } else { %>
      <div class="empty-state">
        <span class="empty-icon">üì∞</span>
        <h3>–ù–æ–≤–æ—Å—Ç–µ–π –ø–æ–∫–∞ –Ω–µ—Ç</h3>
        <p>–°–ª–µ–¥–∏—Ç–µ –∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏, —Å–∫–æ—Ä–æ –∑–¥–µ—Å—å –ø–æ—è–≤—è—Ç—Å—è –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏!</p>
      </div>
    <% } %>
  </div>

  <!-- Pagination -->
  <div class="pagination">
    <button class="btn ghost" onclick="loadPage(1)">
      <span class="btn-icon">‚èÆÔ∏è</span>
      –ü–µ—Ä–≤–∞—è
    </button>
    <button class="btn ghost" onclick="loadPage(currentPage - 1)" <%= currentPage <= 1 ? 'disabled' : '' %>>
      <span class="btn-icon">‚¨ÖÔ∏è</span>
      –ü—Ä–µ–¥—ã–¥—É—â–∞—è
    </button>
    <span class="page-info">–°—Ç—Ä–∞–Ω–∏—Ü–∞ <%= currentPage || 1 %> –∏–∑ <%= totalPages || 1 %></span>
    <button class="btn ghost" onclick="loadPage(currentPage + 1)" <%= currentPage >= totalPages ? 'disabled' : '' %>>
      –°–ª–µ–¥—É—é—â–∞—è
      <span class="btn-icon">‚û°Ô∏è</span>
    </button>
    <button class="btn ghost" onclick="loadPage(totalPages)">
      –ü–æ—Å–ª–µ–¥–Ω—è—è
      <span class="btn-icon">‚è≠Ô∏è</span>
    </button>
  </div>
</div>

<!-- Create News Modal -->
<% if (user && user.role === 'admin') { %>
<div id="createNewsModal" class="modal" style="display: none;">
  <div class="modal-content">
    <div class="modal-header">
      <h2>‚úèÔ∏è –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ—Å—Ç—å</h2>
      <button class="close-btn" onclick="hideCreateNewsModal()">&times;</button>
    </div>
    <div class="modal-body">
      <form id="createNewsForm" action="/admin/news/create" method="POST">
        <div class="form-group">
          <label for="newsTitle">–ó–∞–≥–æ–ª–æ–≤–æ–∫:</label>
          <input type="text" id="newsTitle" name="title" required maxlength="200" class="form-input">
        </div>
        <div class="form-group">
          <label for="newsCategory">–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
          <select id="newsCategory" name="category" required class="form-input">
            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
            <option value="announcements">üì¢ –û–±—ä—è–≤–ª–µ–Ω–∏—è</option>
            <option value="updates">üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏—è</option>
            <option value="events">üéâ –°–æ–±—ã—Ç–∏—è</option>
            <option value="security">üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</option>
            <option value="market">üí∞ –ú–∞—Ä–∫–µ—Ç</option>
          </select>
        </div>
        <div class="form-group">
          <label for="newsExcerpt">–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ:</label>
          <textarea id="newsExcerpt" name="excerpt" required maxlength="300" rows="3" class="form-input"></textarea>
        </div>
        <div class="form-group">
          <label for="newsContent">–ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç:</label>
          <textarea id="newsContent" name="content" required rows="8" class="form-input"></textarea>
        </div>
        <div class="form-actions">
          <button type="button" onclick="hideCreateNewsModal()" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</button>
          <button type="submit" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ—Å—Ç—å</button>
        </div>
      </form>
    </div>
  </div>
</div>
<% } %>

<script>
function applyFilters() {
  const category = document.getElementById('categoryFilter').value;
  const period = document.getElementById('periodFilter').value;
  
  // Filter logic here
  const cards = document.querySelectorAll('.news-card');
  cards.forEach(card => {
    let show = true;
    
    if (category && card.dataset.category !== category) {
      show = false;
    }
    
    if (period) {
      const cardDate = new Date(card.dataset.date);
      const now = new Date();
      let cutoffDate;
      
      switch(period) {
        case 'today':
          cutoffDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());
          break;
        case 'week':
          cutoffDate = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
          break;
        case 'month':
          cutoffDate = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
          break;
      }
      
      if (cutoffDate && cardDate < cutoffDate) {
        show = false;
      }
    }
    
    card.style.display = show ? 'block' : 'none';
  });
}

function loadPage(page) {
  window.location.href = `/news?page=${page}`;
}

// Auto-apply filters on page load
document.addEventListener('DOMContentLoaded', function() {
  const urlParams = new URLSearchParams(window.location.search);
  const category = urlParams.get('category');
  const period = urlParams.get('period');
  
  if (category) {
    document.getElementById('categoryFilter').value = category;
  }
  if (period) {
    document.getElementById('periodFilter').value = period;
  }
  
  if (category || period) {
    applyFilters();
  }
});

<% if (user && user.role === 'admin') { %>
function showCreateNewsModal() {
  document.getElementById('createNewsModal').style.display = 'flex';
}

function hideCreateNewsModal() {
  document.getElementById('createNewsModal').style.display = 'none';
  document.getElementById('createNewsForm').reset();
}

// Close modal on outside click
document.getElementById('createNewsModal').addEventListener('click', function(e) {
  if (e.target === this) {
    hideCreateNewsModal();
  }
});
<% } %>
</script>
<script src="/js/dropdown.js"></script>
<script src="/js/theme-switcher.js"></script>
</body>
</html>
