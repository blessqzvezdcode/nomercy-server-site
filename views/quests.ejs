<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ö–≤–µ—Å—Ç—ã - NoMercy Marketplace</title>
  <link rel="stylesheet" href="/css/base.css">
<link rel="stylesheet" href="/css/quests.css">
</head>
<body>
    <nav>
        <a href="/" class="brand">NoMercy</a>
        <div class="nav-buttons">
            <% if (user) { %>
                <a href="/messenger" class="nav-messenger-btn" title="–ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä">üí¨</a>
                <div class="dropdown">
                    <button class="dropdown-toggle">
                        <span>üë§ <%= user.name %> (üí∞ <%= balance %>)</span>
                    </button>
                    <div class="dropdown-menu">
                        <a href="/" class="dropdown-item">üè† –ì–ª–∞–≤–Ω–∞—è</a>
                        <a href="/profile/<%= user.id %>" class="dropdown-item">üë§ –ü—Ä–æ—Ñ–∏–ª—å</a>
                        <a href="/market" class="dropdown-item">üõí –ú–∞—Ä–∫–µ—Ç</a>
                        <a href="/cards" class="dropdown-item">üÉè –ö–∞—Ä—Ç—ã</a>
                        <a href="/quests" class="dropdown-item active">‚öîÔ∏è –ö–≤–µ—Å—Ç—ã</a>
                        <a href="/games" class="dropdown-item">üéÆ –ò–≥—Ä—ã</a>
                        <a href="/news" class="dropdown-item">üì∞ –ù–æ–≤–æ—Å—Ç–∏</a>
                        <a href="/faq" class="dropdown-item">‚ùì FAQ</a>
                        <a href="/achievements" class="dropdown-item">üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</a>
                        <a href="/support" class="dropdown-item">üéß –ü–æ–¥–¥–µ—Ä–∂–∫–∞</a>
                        <div class="dropdown-divider"></div>
                        <% if (user.role === 'admin') { %>
                            <a href="/admin" class="dropdown-item">‚öôÔ∏è –ê–¥–º–∏–Ω–∫–∞</a>
                            <div class="dropdown-divider"></div>
                        <% } %>
                        <button class="dropdown-item theme-toggle" id="theme-toggle">üåô –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞</button>
                        <div class="dropdown-divider"></div>
                        <a href="/logout" class="dropdown-item">üö™ –í—ã–π—Ç–∏</a>
                    </div>
                </div>
            <% } else { %>
                <a href="/auth/discord" class="btn">–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Discord</a>
            <% } %>
        </div>
    </nav>

<div class="container">
  <div class="quests-header">
    <h1>üéØ –°–∏—Å—Ç–µ–º–∞ –∫–≤–µ—Å—Ç–æ–≤</h1>
    <p class="quests-subtitle">–í—ã–ø–æ–ª–Ω—è–π—Ç–µ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è –∏ –ø–æ–ª—É—á–∞–π—Ç–µ –Ω–∞–≥—Ä–∞–¥—ã!</p>
  </div>

  <!-- Daily Quest -->
  <div class="quest-card">
    <div class="quest-header">
      <div class="quest-icon">üìÖ</div>
      <div class="quest-info">
        <h3>–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –∫–≤–µ—Å—Ç</h3>
        <p>–ó–∞—Ö–æ–¥–∏—Ç–µ –Ω–∞ —Å–∞–π—Ç –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –∏ –ø–æ–ª—É—á–∞–π—Ç–µ —É–≤–µ–ª–∏—á–∏–≤–∞—é—â–∏–µ—Å—è –Ω–∞–≥—Ä–∞–¥—ã!</p>
      </div>
      <div class="quest-status">
        <% if (canClaimDaily) { %>
          <span class="status-available">‚úÖ –î–æ—Å—Ç—É–ø–Ω–æ</span>
        <% } else { %>
          <span class="status-claimed">‚è∞ –£–∂–µ –ø–æ–ª—É—á–µ–Ω–æ</span>
        <% } %>
      </div>
    </div>
    
    <div class="quest-details">
      <div class="quest-reward">
        <span class="reward-label">–ù–∞–≥—Ä–∞–¥–∞:</span>
        <span class="reward-amount">
          <% if (canClaimDaily) { %>
            <%= 10 * Math.pow(2, (user.dailyStreak || 0)) %> NMCoin
          <% } else { %>
            <%= 10 * Math.pow(2, (user.dailyStreak || 0)) %> NMCoin
          <% } %>
        </span>
      </div>
      
      <div class="quest-streak">
        <span class="streak-label">–°–µ—Ä–∏—è –¥–Ω–µ–π:</span>
        <span class="streak-count"><%= user.dailyStreak || 0 %> –¥–Ω–µ–π</span>
      </div>
      
      <% if (canClaimDaily) { %>
        <button class="btn claim-btn" onclick="claimDaily()">
          <span class="btn-icon">üí∞</span>
          –ü–æ–ª—É—á–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É
        </button>
      <% } else { %>
        <div class="quest-cooldown">
          <span class="cooldown-text">–°–ª–µ–¥—É—é—â–∏–π –∫–≤–µ—Å—Ç –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –∑–∞–≤—Ç—Ä–∞</span>
        </div>
      <% } %>
    </div>
  </div>

  <!-- Monthly Bonus -->
  <div class="quest-card">
    <div class="quest-header">
      <div class="quest-icon">üéÅ</div>
      <div class="quest-info">
        <h3>–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –±–æ–Ω—É—Å</h3>
        <p>–ü–æ–ª—É—á–∞–π—Ç–µ 500 NMCoin –∫–∞–∂–¥—ã–π –º–µ—Å—è—Ü –∑–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å!</p>
      </div>
      <div class="quest-status">
        <% if (canClaimMonthly) { %>
          <span class="status-available">‚úÖ –î–æ—Å—Ç—É–ø–Ω–æ</span>
        <% } else { %>
          <span class="status-claimed">‚è∞ –£–∂–µ –ø–æ–ª—É—á–µ–Ω–æ</span>
        <% } %>
      </div>
    </div>
    
    <div class="quest-details">
      <div class="quest-reward">
        <span class="reward-label">–ù–∞–≥—Ä–∞–¥–∞:</span>
        <span class="reward-amount">500 NMCoin</span>
      </div>
      
      <% if (canClaimMonthly) { %>
        <button class="btn claim-btn" onclick="claimMonthly()">
          <span class="btn-icon">üéÅ</span>
          –ü–æ–ª—É—á–∏—Ç—å –±–æ–Ω—É—Å
        </button>
      <% } else { %>
        <div class="quest-cooldown">
          <span class="cooldown-text">–°–ª–µ–¥—É—é—â–∏–π –±–æ–Ω—É—Å –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –≤ —Å–ª–µ–¥—É—é—â–µ–º –º–µ—Å—è—Ü–µ</span>
        </div>
      <% } %>
    </div>
  </div>

  <!-- Quest History -->
  <div class="quest-history">
    <h3>üìä –ò—Å—Ç–æ—Ä–∏—è –∫–≤–µ—Å—Ç–æ–≤</h3>
    <div class="history-stats">
      <div class="stat-card">
        <div class="stat-icon">üìÖ</div>
        <div class="stat-info">
          <div class="stat-value"><%= user.dailyStreak || 0 %></div>
          <div class="stat-label">–î–Ω–µ–π –ø–æ–¥—Ä—è–¥</div>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon">üí∞</div>
        <div class="stat-info">
          <div class="stat-value"><%= user.totalEarned || 0 %></div>
          <div class="stat-label">–í—Å–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</div>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon">üèÜ</div>
        <div class="stat-info">
          <div class="stat-value"><%= user.questsCompleted || 0 %></div>
          <div class="stat-label">–ö–≤–µ—Å—Ç–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ</div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
async function claimDaily() {
  try {
    const response = await fetch('/quests/daily', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      }
    });
    
    const result = await response.json();
    
    if (result.success) {
      alert(`–ü–æ–ª—É—á–µ–Ω–æ ${result.reward} NMCoin! –ù–æ–≤—ã–π –±–∞–ª–∞–Ω—Å: ${result.newBalance} NMCoin`);
      location.reload();
    } else {
      alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –Ω–∞–≥—Ä–∞–¥—ã');
    }
  } catch (error) {
    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –Ω–∞–≥—Ä–∞–¥—ã');
  }
}

async function claimMonthly() {
  try {
    const response = await fetch('/quests/monthly', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      }
    });
    
    const result = await response.json();
    
    if (result.success) {
      alert(`–ü–æ–ª—É—á–µ–Ω–æ ${result.reward} NMCoin! –ù–æ–≤—ã–π –±–∞–ª–∞–Ω—Å: ${result.newBalance} NMCoin`);
      location.reload();
    } else {
      alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –Ω–∞–≥—Ä–∞–¥—ã');
    }
  } catch (error) {
    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –Ω–∞–≥—Ä–∞–¥—ã');
  }
}
</script>
<script src="/js/dropdown.js"></script>
<script src="/js/theme-switcher.js"></script>
</body>
</html>
